(function(e,t,n,r){"use strict";var i=e.location.host.split(":")[1]||"80",s=e.location.origin+":"+i+"/eval/unsafe.php",o=e.location.origin+":"+i+"/eval/index.php",u="http://phpepl.cloudcontrolled.com/eval/index.php",a=e.location.host==="phpepl.cloudcontrolled.com",f=a?u:s,l=e.mixpanel||{},c;var h=function(e){var t=!!arguments[1],i=n(".output span");i.html(e).removeClass("error");if(t)i.addClass("error");n(".spinner").fadeOut("fast");n(".timestamp").find("span").html(r((new Date).getTime()).format("h:mm a"))},p=function(e){n(".CodeMirror-linenumber").each(function(){if(Number(n(this).html())===e){n(this).addClass("error-gutter");return}})},d=function(e){if(!e.length)return;var t=e,r=["\n",/<br \/>/g,/<b>/g,/<\/b>/g,/(Fatal error: +)/g],i,s,o,u;if(!e.toLowerCase().indexOf("fatal error")){return[e,1]}n.each(r,function(e,n){t=t.replace(n,"")});i=t.split("in");s=i[0].trim();i=t.split("on");o=i[1].trim();t=(s+" on "+o).trim();u=o.split(" ");u=Number(u[1]);return[t,u]},v=function(e){return n.ajax({type:"POST",url:f,data:{code:e},dataType:"json"})},m=function(){var e=c.getValue();if(!e.length){h("Please supply some code...");return}n(".spinner").fadeIn("fast");l.track("Code Run",{code:e});v(e).done(function(e){if(!e)return;var t=e.result,n=e.error,r="";if(n){if(n.line&&n.message){p(n.line);r="Line "+n.line+": "}r+=n.message;h(r,true);return}h(t)}).fail(function(e){if(!e)return;var t=d(e.responseText);h(t[0],true);p(t[1]);l.track("Error",{error:e.responseText})})};var g=function(){if(e.localStorage){var t=c.getValue();localStorage.setItem("code",t);n(".timestamp").find("span").html("Code Saved!");l.track("Code Saved")}},y=function(){if(e.localStorage){var t='echo "We\'re running php version: " . phpversion();',n=localStorage.getItem("code"),r=!n?t:n;c.setValue(r)}};c=e.CodeMirror(n("#editor")[0],{lineNumbers:true,matchBrackets:true,mode:"text/x-php",indentUnit:2,tabSize:2,autofocus:true,autoCloseBrackets:true});y();n(".submit button").click(m);n(t).keydown(function(e){if(e.which===13&&(e.ctrlKey||e.metaKey)){m();e.preventDefault()}if(e.which===83&&(e.ctrlKey||e.metaKey)){g();e.preventDefault();l.track("Save Shortcut")}});n(e).unload(g)})(window,document,window.jQuery,window.moment)